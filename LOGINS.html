<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aaron Agronomy System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2E7D32;
            --primary-light: #4CAF50;
            --primary-dark: #1B5E20;
            --secondary: #FF9800;
            --light: #F5F5F5;
            --dark: #333333;
            --gray: #757575;
            --light-gray: #EEEEEE;
            --danger: #D32F2F;
            --success: #388E3C;
            --warning: #F57C00;
            --info: #1976D2;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f9f9f9;
            color: var(--dark);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
        }

        .logo-img {
            height: 50px;
            width: auto;
            background-color: #fff;
            padding: 5px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-img img {
            max-height: 100%;
            max-width: 100%;
            object-fit: contain;
        }

        /* Auth Page */
        .auth-page {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }

        .auth-card {
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 500px;
            padding: 40px;
        }

        .auth-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .auth-header h2 {
            color: var(--primary);
            font-size: 28px;
            margin-bottom: 10px;
        }

        .auth-header p {
            color: var(--gray);
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 25px;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid var(--light-gray);
        }

        .auth-tab {
            flex: 1;
            text-align: center;
            padding: 12px;
            background-color: white;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .auth-tab.active {
            background-color: var(--primary);
            color: white;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--light-gray);
            border-radius: 6px;
            font-size: 16px;
            transition: border 0.3s;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .btn-submit {
            width: 100%;
            padding: 14px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-top: 10px;
        }

        .btn-submit:hover {
            background-color: var(--primary-dark);
        }

        .error-message {
            color: var(--danger);
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }

        .success-message {
            color: var(--success);
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }

        /* Dashboard Layout */
        .dashboard-container {
            display: none;
            min-height: 100vh;
        }

        .dashboard-header {
            background-color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 15px 0;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dashboard-title {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .dashboard-title h1 {
            color: var(--primary);
            font-size: 24px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background-color: var(--primary-light);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .logout-btn {
            background-color: var(--light-gray);
            color: var(--dark);
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.3s;
        }

        .logout-btn:hover {
            background-color: #e0e0e0;
        }

        /* Dashboard Main Content */
        .dashboard-main {
            padding: 30px 0;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }

        .stat-icon.farmers { background-color: #4CAF50; }
        .stat-icon.reports { background-color: #2196F3; }
        .stat-icon.orders { background-color: #9C27B0; }
        .stat-icon.sales { background-color: #009688; }
        .stat-icon.profit { background-color: #673AB7; }
        .stat-icon.visits { background-color: #FF9800; }

        .stat-info h3 {
            font-size: 28px;
            margin-bottom: 5px;
        }

        .stat-info p {
            color: var(--gray);
            font-size: 14px;
        }

        /* Dashboard Cards */
        .dashboard-card {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            padding: 25px;
            transition: transform 0.3s;
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--light-gray);
        }

        .card-header h3 {
            font-size: 18px;
            color: var(--primary);
        }

        .card-actions {
            display: flex;
            gap: 10px;
        }

        .btn-action {
            padding: 6px 12px;
            background-color: var(--primary-light);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .btn-action:hover {
            background-color: var(--primary);
            transform: translateY(-2px);
        }

        .btn-download { background-color: var(--info); }
        .btn-print { background-color: var(--warning); }
        .btn-delete { background-color: var(--danger); }
        .btn-edit { background-color: var(--info); }

        /* Tables */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .data-table th, .data-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--light-gray);
        }

        .data-table th {
            background-color: rgba(46, 125, 50, 0.05);
            color: var(--primary);
            font-weight: 600;
        }

        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-pending {
            background-color: rgba(255, 152, 0, 0.1);
            color: var(--warning);
        }

        .status-completed {
            background-color: rgba(56, 142, 60, 0.1);
            color: var(--success);
        }

        .status-scheduled {
            background-color: rgba(33, 150, 243, 0.1);
            color: var(--info);
        }

        /* Forms */
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }

        /* Report Display */
        .report-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .report-item {
            padding: 15px;
            border: 1px solid var(--light-gray);
            border-radius: 6px;
            margin-bottom: 10px;
            background-color: white;
        }

        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .report-title {
            font-weight: 600;
            color: var(--primary);
        }

        .report-date {
            color: var(--gray);
            font-size: 14px;
        }

        .report-summary {
            color: var(--dark);
            margin-bottom: 10px;
            font-size: 14px;
        }

        .report-recommendations {
            padding: 10px;
            background-color: rgba(46, 125, 50, 0.05);
            border-radius: 4px;
            font-size: 14px;
            color: var(--dark);
        }

        /* Profit Graph */
        .profit-graph-container {
            margin-top: 20px;
            padding: 15px;
            background-color: white;
            border-radius: 8px;
            border: 1px solid var(--light-gray);
        }

        .profit-graph {
            height: 250px;
            position: relative;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 48px;
            margin-bottom: 15px;
            color: var(--light-gray);
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 400px;
            transform: translateX(150%);
            transition: transform 0.3s ease-in-out;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-left: 4px solid var(--success);
        }

        .notification.error {
            border-left: 4px solid var(--danger);
        }

        .notification.info {
            border-left: 4px solid var(--info);
        }

        .notification-icon {
            font-size: 20px;
        }

        .notification.success .notification-icon {
            color: var(--success);
        }

        .notification.error .notification-icon {
            color: var(--danger);
        }

        .notification.info .notification-icon {
            color: var(--info);
        }

        /* Loading Overlay */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 9998;
            justify-content: center;
            align-items: center;
        }

        .loading-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .loading-content i {
            color: var(--primary);
            margin-bottom: 15px;
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            padding: 30px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h3 {
            color: var(--primary);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--gray);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .dashboard-grid, .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .header-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .auth-card {
                padding: 25px;
            }
            
            .auth-tabs {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
     <header>
        <div class="container header-container">
            <a href="index.html" class="logo">
                <div class="logo-img">
                    <img src="aaron logo.webp" alt="Aaron Agronomy Services Logo" onerror="this.style.display='none'">
        
                </div>  
            </a>
        </header>
    <!-- Header -->
    <header class="dashboard-header" style="display: none;">
        <div class="container header-content">
            <div class="dashboard-title">
                <i class="fas fa-tractor"></i>
                <h1>Aaron Agronomy System</h1>
            </div>
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">U</div>
                <div>
                    <h4 id="userName">User</h4>
                    <p id="userRole">Role</p>
                </div>
                <button class="logout-btn" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</button>
            </div>
        </div>
    </header>

    <!-- Authentication Page -->
    <div class="auth-page" id="authPage">
        <div class="auth-card">
            <div class="auth-header">
                <h2>Aaron Agronomy System</h2>
                <p>Farm Management & Advisory Platform</p>
            </div>
            
            <div class="auth-tabs">
                <div class="auth-tab active" data-tab="farmerLogin">Farmer Login</div>
                <div class="auth-tab" data-tab="farmerSignup">Farmer Sign Up</div>
                <div class="auth-tab" data-tab="agronomistLogin">Agronomist Login</div>
            </div>
            
            <!-- Farmer Login Form -->
            <form id="farmerLoginForm" class="auth-form active">
                <div class="form-group">
                    <label for="farmerLoginEmail">Email Address</label>
                    <input type="email" id="farmerLoginEmail" placeholder="Enter your email" required>
                </div>
                
                <div class="form-group">
                    <label for="farmerLoginPassword">Password</label>
                    <input type="password" id="farmerLoginPassword" placeholder="Enter your password" required>
                    <div class="error-message" id="farmerLoginError"></div>
                </div>
                
                <button type="submit" class="btn-submit">
                    <i class="fas fa-sign-in-alt"></i> Login as Farmer
                </button>
            </form>
            
            <!-- Farmer Signup Form -->
            <form id="farmerSignupForm" class="auth-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="signupFirstName">First Name</label>
                        <input type="text" id="signupFirstName" placeholder="Enter first name" required>
                    </div>
                    <div class="form-group">
                        <label for="signupLastName">Last Name</label>
                        <input type="text" id="signupLastName" placeholder="Enter last name" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="signupEmail">Email Address</label>
                    <input type="email" id="signupEmail" placeholder="Enter your email" required>
                </div>
                
                <div class="form-group">
                    <label for="signupPhone">Phone Number</label>
                    <input type="tel" id="signupPhone" placeholder="Enter phone number" required>
                </div>
                
                <div class="form-group">
                    <label for="signupLocation">Location/Farm Area</label>
                    <input type="text" id="signupLocation" placeholder="Enter your location" required>
                </div>
                
                <div class="form-group">
                    <label for="signupFarmSize">Farm Size (acres)</label>
                    <input type="number" id="signupFarmSize" placeholder="Enter farm size" required min="0.1" step="0.1">
                </div>
                
                <div class="form-group">
                    <label for="signupMainCrop">Main Crop</label>
                    <input type="text" id="signupMainCrop" placeholder="e.g., Maize, Wheat, Coffee" required>
                </div>
                
                <div class="form-group">
                    <label for="signupPassword">Password</label>
                    <input type="password" id="signupPassword" placeholder="Create password" required minlength="6">
                </div>
                
                <div class="form-group">
                    <label for="signupConfirmPassword">Confirm Password</label>
                    <input type="password" id="signupConfirmPassword" placeholder="Confirm password" required>
                    <div class="error-message" id="signupError"></div>
                    <div class="success-message" id="signupSuccess"></div>
                </div>
                
                <button type="submit" class="btn-submit">
                    <i class="fas fa-user-plus"></i> Create Farmer Account
                </button>
            </form>
            
            <!-- Agronomist Login Form -->
            <form id="agronomistLoginForm" class="auth-form">
                <div class="form-group">
                    <label for="agroUsername">Username</label>
                    <input type="text" id="agroUsername" placeholder="Enter agronomist username" required>
                </div>
                
                <div class="form-group">
                    <label for="agroPassword">Password</label>
                    <input type="password" id="agroPassword" placeholder="Enter agronomist password" required>
                    <div class="error-message" id="agroLoginError"></div>
                </div>
                
                <button type="submit" class="btn-submit">
                    <i class="fas fa-user-md"></i> Login as Agronomist
                </button>
            </form>
        </div>
    </div>

    <!-- Farmer Dashboard -->
    <div class="dashboard-container" id="farmerDashboard">
        <div class="dashboard-main container">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon farmers">
                        <i class="fas fa-tractor"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="farmerFarmsCount">0</h3>
                        <p>My Farms</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon reports">
                        <i class="fas fa-file-alt"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="farmerReportsCount">0</h3>
                        <p>Reports</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon profit">
                        <i class="fas fa-money-bill-wave"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="farmerTotalProfit">$0</h3>
                        <p>Total Profit</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon sales">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="farmerTotalSales">0</h3>
                        <p>Total Sales</p>
                    </div>
                </div>
            </div>
            
            <div class="dashboard-grid">
                <!-- My Profile -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3><i class="fas fa-user"></i> My Profile</h3>
                        <button class="btn-action" id="editProfileBtn"><i class="fas fa-edit"></i> Edit</button>
                    </div>
                    <div id="farmerProfileInfo">
                        <!-- Profile info loaded dynamically -->
                    </div>
                </div>
                
                <!-- Profit Tracking -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3><i class="fas fa-chart-line"></i> Profit Tracking</h3>
                        <div class="card-actions">
                            <button class="btn-action" id="addProfitRecordBtn"><i class="fas fa-plus"></i> Add Record</button>
                            <button class="btn-action btn-download" id="downloadProfitReport"><i class="fas fa-download"></i> Report</button>
                        </div>
                    </div>
                    <div id="profitTracking">
                        <!-- Profit records and graph will be loaded here -->
                    </div>
                </div>
                
                <!-- My Reports -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3><i class="fas fa-file-medical-alt"></i> My Reports</h3>
                        <div class="card-actions">
                            <button class="btn-action" id="searchReportBtn"><i class="fas fa-search"></i> Search Report</button>
                        </div>
                    </div>
                    <div id="farmerReportsList" class="report-list">
                        <!-- Reports loaded dynamically -->
                    </div>
                </div>
                
                <!-- Farm Management -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3><i class="fas fa-seedling"></i> Farm Management</h3>
                        <button class="btn-action" id="addFarmBtn"><i class="fas fa-plus"></i> Add Farm</button>
                    </div>
                    <div id="farmsList">
                        <!-- Farms loaded dynamically -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Agronomist Dashboard -->
    <div class="dashboard-container" id="agronomistDashboard">
        <div class="dashboard-main container">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon farmers">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalFarmersCount">0</h3>
                        <p>Total Farmers</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon profit">
                        <i class="fas fa-chart-pie"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalSystemProfit">$0</h3>
                        <p>System Profit</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon reports">
                        <i class="fas fa-file-alt"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalReportsCount">0</h3>
                        <p>Reports Generated</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon visits">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="scheduledVisitsCount">0</h3>
                        <p>Scheduled Visits</p>
                    </div>
                </div>
            </div>
            
            <div class="dashboard-grid">
                <!-- Farmers Management -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3><i class="fas fa-users"></i> Farmers Management</h3>
                        <div class="card-actions">
                            <button class="btn-action" id="registerFarmerBtn"><i class="fas fa-user-plus"></i> Register Farmer</button>
                            <button class="btn-action" id="searchFarmerBtn"><i class="fas fa-search"></i> Search</button>
                        </div>
                    </div>
                    <div id="farmersManagement">
                        <!-- Farmers list loaded dynamically -->
                    </div>
                </div>
                
                <!-- Profit Analysis -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3><i class="fas fa-chart-bar"></i> Profit Analysis</h3>
                        <div class="card-actions">
                            <button class="btn-action" id="viewAllProfitsBtn"><i class="fas fa-eye"></i> View All</button>
                            <button class="btn-action btn-download" id="downloadSystemProfit"><i class="fas fa-download"></i> Report</button>
                        </div>
                    </div>
                    <div id="profitAnalysis">
                        <!-- Profit analysis will be loaded here -->
                    </div>
                </div>
                
                <!-- Create Reports -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3><i class="fas fa-file-medical-alt"></i> Create Reports</h3>
                        <button class="btn-action" id="createReportBtn"><i class="fas fa-plus"></i> New Report</button>
                    </div>
                    <div id="agronomistReportsSection">
                        <!-- Reports interface loaded dynamically -->
                    </div>
                </div>
                
                <!-- Schedule Management -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3><i class="fas fa-calendar-check"></i> Schedule Management</h3>
                        <button class="btn-action" id="scheduleVisitBtn"><i class="fas fa-plus"></i> Schedule Visit</button>
                    </div>
                    <div id="scheduleManagement">
                        <!-- Schedule loaded dynamically -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Add Profit Record Modal -->
    <div class="modal" id="addProfitRecordModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Profit Record</h3>
                <button class="close-modal" data-modal="addProfitRecordModal">&times;</button>
            </div>
            <form id="addProfitRecordForm">
                <div class="form-group">
                    <label for="profitCropType">Crop Type</label>
                    <select id="profitCropType" required>
                        <option value="">Select crop</option>
                        <option value="maize">Maize</option>
                        <option value="wheat">Wheat</option>
                        <option value="coffee">Coffee</option>
                        <option value="tea">Tea</option>
                        <option value="beans">Beans</option>
                        <option value="rice">Rice</option>
                        <option value="potatoes">Potatoes</option>
                        <option value="vegetables">Vegetables</option>
                        <option value="fruits">Fruits</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="profitMonth">Month</label>
                        <select id="profitMonth" required>
                            <option value="">Select month</option>
                            <option value="1">January</option>
                            <option value="2">February</option>
                            <option value="3">March</option>
                            <option value="4">April</option>
                            <option value="5">May</option>
                            <option value="6">June</option>
                            <option value="7">July</option>
                            <option value="8">August</option>
                            <option value="9">September</option>
                            <option value="10">October</option>
                            <option value="11">November</option>
                            <option value="12">December</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="profitYear">Year</label>
                        <select id="profitYear" required>
                            <option value="">Select year</option>
                            <option value="2023">2023</option>
                            <option value="2024">2024</option>
                            <option value="2025">2025</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="profitProduce">Produce (kg)</label>
                        <input type="number" id="profitProduce" placeholder="Total produce in kg" required min="0" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="profitSales">Sales ($)</label>
                        <input type="number" id="profitSales" placeholder="Total sales amount" required min="0" step="0.01">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="profitCosts">Production Costs ($)</label>
                        <input type="number" id="profitCosts" placeholder="Total costs" required min="0" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="profitPricePerKg">Price per Kg ($)</label>
                        <input type="number" id="profitPricePerKg" placeholder="Sale price per kg" required min="0" step="0.01">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="profitFarm">Farm (Optional)</label>
                    <select id="profitFarm">
                        <option value="">Select farm (optional)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="profitNotes">Notes</label>
                    <textarea id="profitNotes" rows="3" placeholder="Any additional notes about this record..."></textarea>
                </div>
                
                <button type="submit" class="btn-submit">
                    <i class="fas fa-save"></i> Save Profit Record
                </button>
            </form>
        </div>
    </div>

    <!-- Search Report Modal -->
    <div class="modal" id="searchReportModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Search My Report</h3>
                <button class="close-modal" data-modal="searchReportModal">&times;</button>
            </div>
            <form id="searchReportForm">
                <div class="form-group">
                    <label for="reportSearchId">Enter Farmer ID</label>
                    <input type="text" id="reportSearchId" placeholder="Enter your assigned Farmer ID" required>
                    <small style="color: var(--gray);">Your Farmer ID was provided during registration</small>
                </div>
                <button type="submit" class="btn-submit">
                    <i class="fas fa-search"></i> Search Report
                </button>
            </form>
            <div id="reportSearchResult" style="margin-top: 20px;"></div>
        </div>
    </div>

    <!-- Add Farm Modal -->
    <div class="modal" id="addFarmModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Farm</h3>
                <button class="close-modal" data-modal="addFarmModal">&times;</button>
            </div>
            <form id="addFarmForm">
                <div class="form-group">
                    <label for="farmName">Farm Name</label>
                    <input type="text" id="farmName" placeholder="e.g., Main Farm, North Field" required>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="farmSize">Size (acres)</label>
                        <input type="number" id="farmSize" required min="0.1" step="0.1">
                    </div>
                    <div class="form-group">
                        <label for="farmLocation">Location</label>
                        <input type="text" id="farmLocation" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="farmCrops">Main Crops</label>
                    <input type="text" id="farmCrops" placeholder="e.g., Maize, Beans, Wheat" required>
                </div>
                
                <div class="form-group">
                    <label for="farmSoilType">Soil Type</label>
                    <select id="farmSoilType" required>
                        <option value="">Select soil type</option>
                        <option value="loamy">Loamy</option>
                        <option value="clay">Clay</option>
                        <option value="sandy">Sandy</option>
                        <option value="silt">Silt</option>
                        <option value="clay_loam">Clay Loam</option>
                        <option value="sandy_loam">Sandy Loam</option>
                    </select>
                </div>
                
                <button type="submit" class="btn-submit">
                    <i class="fas fa-save"></i> Save Farm Details
                </button>
            </form>
        </div>
    </div>

    <!-- Register Farmer Modal (Agronomist) -->
    <div class="modal" id="registerFarmerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Register New Farmer</h3>
                <button class="close-modal" data-modal="registerFarmerModal">&times;</button>
            </div>
            <form id="registerFarmerForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="newFarmerFirstName">First Name</label>
                        <input type="text" id="newFarmerFirstName" required>
                    </div>
                    <div class="form-group">
                        <label for="newFarmerLastName">Last Name</label>
                        <input type="text" id="newFarmerLastName" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="newFarmerEmail">Email</label>
                        <input type="email" id="newFarmerEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="newFarmerPhone">Phone</label>
                        <input type="tel" id="newFarmerPhone" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="newFarmerLocation">Location</label>
                    <input type="text" id="newFarmerLocation" required>
                </div>
                
                <div class="form-group">
                    <label for="newFarmerIdNo">National ID Number</label>
                    <input type="text" id="newFarmerIdNo" required>
                </div>
                
                <div class="form-group">
                    <label for="newFarmerFarmSize">Total Farm Size (acres)</label>
                    <input type="number" id="newFarmerFarmSize" required min="0.1" step="0.1">
                </div>
                
                <div class="form-group">
                    <label for="newFarmerMainCrop">Main Crop</label>
                    <input type="text" id="newFarmerMainCrop" required>
                </div>
                
                <div class="form-group">
                    <label for="newFarmerPassword">Initial Password</label>
                    <input type="text" id="newFarmerPassword" value="welcome123" readonly>
                    <small style="color: var(--gray);">Farmer will use this to login initially</small>
                </div>
                
                <div class="form-group">
                    <label for="newFarmerNotes">Additional Notes</label>
                    <textarea id="newFarmerNotes" rows="3"></textarea>
                </div>
                
                <button type="submit" class="btn-submit">
                    <i class="fas fa-user-plus"></i> Register Farmer
                </button>
            </form>
        </div>
    </div>

    <!-- Create Report Modal (Agronomist) -->
    <div class="modal" id="createReportModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create Farmer Report</h3>
                <button class="close-modal" data-modal="createReportModal">&times;</button>
            </div>
            <form id="createReportForm">
                <div class="form-group">
                    <label for="reportFarmerId">Farmer ID</label>
                    <input type="text" id="reportFarmerId" placeholder="Enter Farmer ID" required>
                    <small style="color: var(--gray);">Find Farmer ID in the Farmers Management section</small>
                </div>
                
                <div class="form-group">
                    <label for="reportTitle">Report Title</label>
                    <input type="text" id="reportTitle" placeholder="e.g., Soil Analysis Report - Main Farm" required>
                </div>
                
                <div class="form-group">
                    <label for="reportType">Report Type</label>
                    <select id="reportType" required>
                        <option value="">Select type</option>
                        <option value="soil_analysis">Soil Analysis</option>
                        <option value="crop_assessment">Crop Assessment</option>
                        <option value="pest_diagnosis">Pest Diagnosis</option>
                        <option value="fertilizer_recommendation">Fertilizer Recommendation</option>
                        <option value="harvest_report">Harvest Report</option>
                        <option value="general_advisory">General Advisory</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="reportDate">Report Date</label>
                    <input type="date" id="reportDate" required>
                </div>
                
                <div class="form-group">
                    <label for="reportFindings">Findings/Observations</label>
                    <textarea id="reportFindings" rows="4" placeholder="Enter detailed findings..." required></textarea>
                </div>
                
                <div class="form-group">
                    <label for="reportRecommendations">Recommendations</label>
                    <textarea id="reportRecommendations" rows="4" placeholder="Enter recommendations..." required></textarea>
                </div>
                
                <div class="form-group">
                    <label for="reportNotes">Additional Notes</label>
                    <textarea id="reportNotes" rows="3"></textarea>
                </div>
                
                <button type="submit" class="btn-submit">
                    <i class="fas fa-file-export"></i> Generate Report
                </button>
            </form>
        </div>
    </div>

    <!-- Schedule Visit Modal -->
    <div class="modal" id="scheduleVisitModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Schedule Farm Visit</h3>
                <button class="close-modal" data-modal="scheduleVisitModal">&times;</button>
            </div>
            <form id="scheduleVisitForm">
                <div class="form-group">
                    <label for="visitFarmerId">Farmer ID</label>
                    <input type="text" id="visitFarmerId" placeholder="Enter Farmer ID" required>
                </div>
                
                <div class="form-group">
                    <label for="visitPurpose">Visit Purpose</label>
                    <select id="visitPurpose" required>
                        <option value="">Select purpose</option>
                        <option value="soil_sampling">Soil Sampling</option>
                        <option value="crop_inspection">Crop Inspection</option>
                        <option value="pest_control">Pest Control Assessment</option>
                        <option value="training">Farmer Training</option>
                        <option value="harvest_evaluation">Harvest Evaluation</option>
                        <option value="follow_up">Follow-up Visit</option>
                    </select>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="visitDate">Visit Date</label>
                        <input type="date" id="visitDate" required>
                    </div>
                    <div class="form-group">
                        <label for="visitTime">Visit Time</label>
                        <input type="time" id="visitTime" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="visitLocation">Meeting Location</label>
                    <input type="text" id="visitLocation" placeholder="Farm location or meeting point" required>
                </div>
                
                <div class="form-group">
                    <label for="visitNotes">Additional Notes</label>
                    <textarea id="visitNotes" rows="3"></textarea>
                </div>
                
                <button type="submit" class="btn-submit">
                    <i class="fas fa-calendar-plus"></i> Schedule Visit
                </button>
            </form>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div class="modal" id="editProfileModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Profile</h3>
                <button class="close-modal" data-modal="editProfileModal">&times;</button>
            </div>
            <form id="editProfileForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="editFirstName">First Name</label>
                        <input type="text" id="editFirstName" required>
                    </div>
                    <div class="form-group">
                        <label for="editLastName">Last Name</label>
                        <input type="text" id="editLastName" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="editEmail">Email</label>
                    <input type="email" id="editEmail" required>
                </div>
                
                <div class="form-group">
                    <label for="editPhone">Phone</label>
                    <input type="tel" id="editPhone" required>
                </div>
                
                <div class="form-group">
                    <label for="editLocation">Location</label>
                    <input type="text" id="editLocation" required>
                </div>
                
                <div class="form-group">
                    <label for="editPassword">New Password (leave blank to keep current)</label>
                    <input type="password" id="editPassword" placeholder="Enter new password">
                </div>
                
                <div class="form-group">
                    <label for="editConfirmPassword">Confirm New Password</label>
                    <input type="password" id="editConfirmPassword" placeholder="Confirm new password">
                </div>
                
                <button type="submit" class="btn-submit">
                    <i class="fas fa-save"></i> Save Changes
                </button>
            </form>
        </div>
    </div>

    <!-- View All Profits Modal -->
    <div class="modal" id="viewAllProfitsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>All Profit Records</h3>
                <button class="close-modal" data-modal="viewAllProfitsModal">&times;</button>
            </div>
            <div style="max-height: 500px; overflow-y: auto;">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Month</th>
                            <th>Crop</th>
                            <th>Produce (kg)</th>
                            <th>Sales ($)</th>
                            <th>Costs ($)</th>
                            <th>Profit ($)</th>
                            <th>Profit Margin</th>
                        </tr>
                    </thead>
                    <tbody id="allProfitsTable">
                        <!-- All profits will be loaded here -->
                    </tbody>
                </table>
            </div>
            <div style="margin-top: 20px; text-align: right;">
                <button class="btn-action btn-download" id="downloadAllProfits"><i class="fas fa-download"></i> Download All</button>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer"></div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <i class="fas fa-spinner fa-spin fa-3x"></i>
            <p style="color: var(--dark); font-weight: 500; margin-top: 15px;">Loading...</p>
        </div>
    </div>

    <script>
        // Data Storage
        const systemData = {
            // Agronomist credentials
            agronomistCredentials: {
                username: "Aaron Agronomy",
                password: "9898"
            },
            
            // Farmers data
            farmers: JSON.parse(localStorage.getItem('aaron_farmers')) || [],
            
            // Reports data
            reports: JSON.parse(localStorage.getItem('aaron_reports')) || [],
            
            // Farms data
            farms: JSON.parse(localStorage.getItem('aaron_farms')) || [],
            
            // Profit records
            profits: JSON.parse(localStorage.getItem('aaron_profits')) || [],
            
            // Scheduled visits
            visits: JSON.parse(localStorage.getItem('aaron_visits')) || [],
            
            // Current user session
            currentUser: null,
            
            // Generate unique ID
            generateId: () => 'ID' + Date.now() + Math.random().toString(36).substr(2, 9),
            
            // Save data to localStorage
            saveData: function() {
                localStorage.setItem('aaron_farmers', JSON.stringify(this.farmers));
                localStorage.setItem('aaron_reports', JSON.stringify(this.reports));
                localStorage.setItem('aaron_farms', JSON.stringify(this.farms));
                localStorage.setItem('aaron_profits', JSON.stringify(this.profits));
                localStorage.setItem('aaron_visits', JSON.stringify(this.visits));
            },
            
            // Initialize with sample data if empty
            initializeSampleData: function() {
                if (this.farmers.length === 0) {
                    this.farmers = [
                        {
                            id: 'FARM-001',
                            firstName: 'John',
                            lastName: 'Agritech',
                            email: 'farmer@demo.com',
                            phone: '+254712345678',
                            location: 'Nakuru County',
                            farmSize: 5.5,
                            mainCrop: 'Maize',
                            password: 'farmer123',
                            registrationDate: '2024-01-15',
                            status: 'active'
                        }
                    ];
                    
                    // Sample profit data
                    this.profits = [
                        {
                            id: this.generateId(),
                            farmerId: 'FARM-001',
                            cropType: 'maize',
                            month: 1,
                            year: 2024,
                            produce: 1200,
                            sales: 2400,
                            costs: 1200,
                            pricePerKg: 2.0,
                            profit: 1200,
                            profitMargin: 50,
                            farmId: null,
                            notes: 'Good harvest season',
                            createdAt: '2024-01-31'
                        },
                        {
                            id: this.generateId(),
                            farmerId: 'FARM-001',
                            cropType: 'maize',
                            month: 2,
                            year: 2024,
                            produce: 1500,
                            sales: 3000,
                            costs: 1400,
                            pricePerKg: 2.0,
                            profit: 1600,
                            profitMargin: 53.3,
                            farmId: null,
                            notes: 'Increased production',
                            createdAt: '2024-02-29'
                        },
                        {
                            id: this.generateId(),
                            farmerId: 'FARM-001',
                            cropType: 'wheat',
                            month: 3,
                            year: 2024,
                            produce: 800,
                            sales: 2400,
                            costs: 1000,
                            pricePerKg: 3.0,
                            profit: 1400,
                            profitMargin: 58.3,
                            farmId: null,
                            notes: 'Wheat harvest',
                            createdAt: '2024-03-31'
                        }
                    ];
                    
                    this.saveData();
                }
            }
        };

        // Initialize system
        systemData.initializeSampleData();

        // DOM Elements
        const authPage = document.getElementById('authPage');
        const authTabs = document.querySelectorAll('.auth-tab');
        const authForms = document.querySelectorAll('.auth-form');
        const farmerDashboard = document.getElementById('farmerDashboard');
        const agronomistDashboard = document.getElementById('agronomistDashboard');
        const logoutBtn = document.getElementById('logoutBtn');
        const userAvatar = document.getElementById('userAvatar');
        const userName = document.getElementById('userName');
        const userRole = document.getElementById('userRole');
        const notificationContainer = document.getElementById('notificationContainer');
        const loadingOverlay = document.getElementById('loadingOverlay');

        // Chart instances
        let farmerProfitChart = null;
        let agronomistProfitChart = null;

        // Show notification
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'} notification-icon"></i>
                <div>${message}</div>
            `;
            notificationContainer.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 10);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Show loading
        function showLoading() {
            loadingOverlay.style.display = 'flex';
        }

        // Hide loading
        function hideLoading() {
            loadingOverlay.style.display = 'none';
        }

        // Show modal
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }

        // Hide modal
        function hideModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Format date
        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return new Date(dateString).toLocaleDateString('en-US', options);
        }

        // Get month name
        function getMonthName(monthNumber) {
            const months = [
                'January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'
            ];
            return months[monthNumber - 1];
        }

        // Generate farmer ID
        function generateFarmerId() {
            const prefix = 'FARM';
            const randomNum = Math.floor(1000 + Math.random() * 9000);
            return `${prefix}-${randomNum}`;
        }

        // Calculate profit
        function calculateProfit(sales, costs) {
            const profit = sales - costs;
            const profitMargin = sales > 0 ? (profit / sales) * 100 : 0;
            return { profit, profitMargin: profitMargin.toFixed(1) };
        }

        // Update farmer stats
        function updateFarmerStats() {
            const farmerId = systemData.currentUser?.id;
            if (!farmerId) return;
            
            const farms = systemData.farms.filter(f => f.farmerId === farmerId);
            const reports = systemData.reports.filter(r => r.farmerId === farmerId);
            const profits = systemData.profits.filter(p => p.farmerId === farmerId);
            
            const totalSales = profits.reduce((sum, p) => sum + p.sales, 0);
            const totalProfit = profits.reduce((sum, p) => sum + p.profit, 0);
            
            document.getElementById('farmerFarmsCount').textContent = farms.length;
            document.getElementById('farmerReportsCount').textContent = reports.length;
            document.getElementById('farmerTotalSales').textContent = `$${totalSales.toFixed(2)}`;
            document.getElementById('farmerTotalProfit').textContent = `$${totalProfit.toFixed(2)}`;
        }

        // Update agronomist stats
        function updateAgronomistStats() {
            const totalProfit = systemData.profits.reduce((sum, p) => sum + p.profit, 0);
            
            document.getElementById('totalFarmersCount').textContent = systemData.farmers.length;
            document.getElementById('totalSystemProfit').textContent = `$${totalProfit.toFixed(2)}`;
            document.getElementById('totalReportsCount').textContent = systemData.reports.length;
            document.getElementById('scheduledVisitsCount').textContent = systemData.visits.length;
        }

        // Load farmer profile
        function loadFarmerProfile() {
            const farmer = systemData.currentUser;
            if (!farmer) return;
            
            const profileHtml = `
                <div style="margin-bottom: 15px;">
                    <strong>Farmer ID:</strong> ${farmer.id || 'Not assigned'}
                </div>
                <div style="margin-bottom: 15px;">
                    <strong>Name:</strong> ${farmer.firstName} ${farmer.lastName}
                </div>
                <div style="margin-bottom: 15px;">
                    <strong>Email:</strong> ${farmer.email}
                </div>
                <div style="margin-bottom: 15px;">
                    <strong>Phone:</strong> ${farmer.phone}
                </div>
                <div style="margin-bottom: 15px;">
                    <strong>Location:</strong> ${farmer.location}
                </div>
                <div style="margin-bottom: 15px;">
                    <strong>Farm Size:</strong> ${farmer.farmSize || 'Not specified'} acres
                </div>
                <div style="margin-bottom: 15px;">
                    <strong>Main Crop:</strong> ${farmer.mainCrop || 'Not specified'}
                </div>
                <div style="margin-bottom: 15px;">
                    <strong>Status:</strong> <span class="status-badge status-completed">Active</span>
                </div>
            `;
            
            document.getElementById('farmerProfileInfo').innerHTML = profileHtml;
            
            // Update avatar
            const initials = (farmer.firstName.charAt(0) + farmer.lastName.charAt(0)).toUpperCase();
            userAvatar.textContent = initials;
            userName.textContent = `${farmer.firstName} ${farmer.lastName}`;
            userRole.textContent = 'Farmer';
        }

        // Load farmer profit tracking
        function loadFarmerProfitTracking() {
            const farmerId = systemData.currentUser?.id;
            if (!farmerId) return;
            
            const profits = systemData.profits.filter(p => p.farmerId === farmerId);
            const profitDiv = document.getElementById('profitTracking');
            
            if (profits.length === 0) {
                profitDiv.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-chart-line"></i>
                        <h4>No Profit Records</h4>
                        <p>Add your first profit record to start tracking.</p>
                    </div>
                `;
                return;
            }
            
            // Group profits by month
            const monthlyProfits = {};
            profits.forEach(profit => {
                const key = `${profit.year}-${profit.month.toString().padStart(2, '0')}`;
                if (!monthlyProfits[key]) {
                    monthlyProfits[key] = {
                        month: profit.month,
                        year: profit.year,
                        totalProduce: 0,
                        totalSales: 0,
                        totalCosts: 0,
                        totalProfit: 0,
                        crops: new Set()
                    };
                }
                monthlyProfits[key].totalProduce += profit.produce;
                monthlyProfits[key].totalSales += profit.sales;
                monthlyProfits[key].totalCosts += profit.costs;
                monthlyProfits[key].totalProfit += profit.profit;
                monthlyProfits[key].crops.add(profit.cropType);
            });
            
            // Sort by date
            const sortedMonths = Object.keys(monthlyProfits).sort();
            
            // Prepare data for chart
            const labels = sortedMonths.map(key => {
                const data = monthlyProfits[key];
                return `${getMonthName(data.month)} ${data.year}`;
            });
            
            const profitData = sortedMonths.map(key => monthlyProfits[key].totalProfit);
            
            // Create HTML
            let html = `
                <div class="profit-graph-container">
                    <h4 style="margin-bottom: 15px; color: var(--primary);">Monthly Profit Trend</h4>
                    <div class="profit-graph">
                        <canvas id="farmerProfitChart"></canvas>
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <h4 style="margin-bottom: 15px; color: var(--primary);">Recent Records</h4>
            `;
            
            // Show last 3 records
            const recentProfits = profits.slice(-3).reverse();
            recentProfits.forEach(profit => {
                html += `
                    <div class="report-item" style="margin-bottom: 10px;">
                        <div class="report-header">
                            <div class="report-title">${profit.cropType.charAt(0).toUpperCase() + profit.cropType.slice(1)}</div>
                            <div class="report-date">${getMonthName(profit.month)} ${profit.year}</div>
                        </div>
                        <div class="report-summary">
                            <strong>Produce:</strong> ${profit.produce} kg | 
                            <strong>Sales:</strong> $${profit.sales.toFixed(2)} | 
                            <strong>Costs:</strong> $${profit.costs.toFixed(2)}
                        </div>
                        <div class="report-recommendations">
                            <strong>Profit:</strong> $${profit.profit.toFixed(2)} | 
                            <strong>Margin:</strong> ${profit.profitMargin}%
                        </div>
                    </div>
                `;
            });
            
            html += `</div>`;
            profitDiv.innerHTML = html;
            
            // Create chart
            const ctx = document.getElementById('farmerProfitChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (farmerProfitChart) {
                farmerProfitChart.destroy();
            }
            
            farmerProfitChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Monthly Profit ($)',
                        data: profitData,
                        borderColor: '#4CAF50',
                        backgroundColor: 'rgba(76, 175, 80, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Load farmer reports
        function loadFarmerReports() {
            const farmerId = systemData.currentUser?.id;
            if (!farmerId) return;
            
            const reports = systemData.reports.filter(r => r.farmerId === farmerId);
            const reportsList = document.getElementById('farmerReportsList');
            
            if (reports.length === 0) {
                reportsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-file-alt"></i>
                        <h4>No Reports Yet</h4>
                        <p>Your reports will appear here once the agronomist creates them.</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            reports.forEach(report => {
                html += `
                    <div class="report-item">
                        <div class="report-header">
                            <div class="report-title">${report.title}</div>
                            <div class="report-date">${formatDate(report.date)}</div>
                        </div>
                        <div class="report-summary">
                            <strong>Type:</strong> ${report.type.replace('_', ' ').toUpperCase()}
                        </div>
                        <div class="report-summary">
                            ${report.findings.substring(0, 150)}...
                        </div>
                        <div class="report-recommendations">
                            <strong>Recommendations:</strong> ${report.recommendations.substring(0, 100)}...
                        </div>
                    </div>
                `;
            });
            
            reportsList.innerHTML = html;
        }

        // Load farmer farms
        function loadFarmerFarms() {
            const farmerId = systemData.currentUser?.id;
            if (!farmerId) return;
            
            const farms = systemData.farms.filter(f => f.farmerId === farmerId);
            const farmsList = document.getElementById('farmsList');
            
            if (farms.length === 0) {
                farmsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-tractor"></i>
                        <h4>No Farms Added</h4>
                        <p>Add your farms to manage them here.</p>
                        <button class="btn-action" id="addFirstFarmBtn" style="margin-top: 15px;">
                            <i class="fas fa-plus"></i> Add Your First Farm
                        </button>
                    </div>
                `;
                
                document.getElementById('addFirstFarmBtn')?.addEventListener('click', () => {
                    showModal('addFarmModal');
                });
                return;
            }
            
            let html = '';
            farms.forEach(farm => {
                html += `
                    <div class="report-item">
                        <div class="report-header">
                            <div class="report-title">${farm.name}</div>
                            <div class="report-date">${farm.size} acres</div>
                        </div>
                        <div class="report-summary">
                            <strong>Location:</strong> ${farm.location}
                        </div>
                        <div class="report-summary">
                            <strong>Crops:</strong> ${farm.crops}
                        </div>
                        <div class="report-recommendations">
                            <strong>Soil Type:</strong> ${farm.soilType}
                        </div>
                    </div>
                `;
            });
            
            farmsList.innerHTML = html;
        }

        // Load agronomist profit analysis
        function loadAgronomistProfitAnalysis() {
            const profitDiv = document.getElementById('profitAnalysis');
            
            if (systemData.profits.length === 0) {
                profitDiv.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-chart-bar"></i>
                        <h4>No Profit Data</h4>
                        <p>Farmers need to add profit records first.</p>
                    </div>
                `;
                return;
            }
            
            // Group by crop type
            const cropProfits = {};
            systemData.profits.forEach(profit => {
                if (!cropProfits[profit.cropType]) {
                    cropProfits[profit.cropType] = {
                        totalProduce: 0,
                        totalSales: 0,
                        totalCosts: 0,
                        totalProfit: 0,
                        farmerCount: new Set()
                    };
                }
                cropProfits[profit.cropType].totalProduce += profit.produce;
                cropProfits[profit.cropType].totalSales += profit.sales;
                cropProfits[profit.cropType].totalCosts += profit.costs;
                cropProfits[profit.cropType].totalProfit += profit.profit;
                cropProfits[profit.cropType].farmerCount.add(profit.farmerId);
            });
            
            // Prepare data for chart
            const cropTypes = Object.keys(cropProfits);
            const cropProfitData = cropTypes.map(crop => cropProfits[crop].totalProfit);
            const cropSalesData = cropTypes.map(crop => cropProfits[crop].totalSales);
            
            let html = `
                <div class="profit-graph-container">
                    <h4 style="margin-bottom: 15px; color: var(--primary);">Profit by Crop Type</h4>
                    <div class="profit-graph">
                        <canvas id="agronomistProfitChart"></canvas>
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <h4 style="margin-bottom: 15px; color: var(--primary);">Top Performing Crops</h4>
            `;
            
            // Sort crops by profit
            const sortedCrops = cropTypes.sort((a, b) => cropProfits[b].totalProfit - cropProfits[a].totalProfit);
            
            sortedCrops.slice(0, 3).forEach(crop => {
                const data = cropProfits[crop];
                const profitMargin = data.totalSales > 0 ? (data.totalProfit / data.totalSales) * 100 : 0;
                
                html += `
                    <div class="report-item" style="margin-bottom: 10px;">
                        <div class="report-header">
                            <div class="report-title">${crop.charAt(0).toUpperCase() + crop.slice(1)}</div>
                            <div class="report-date">${data.farmerCount.size} farmers</div>
                        </div>
                        <div class="report-summary">
                            <strong>Total Produce:</strong> ${data.totalProduce.toFixed(0)} kg | 
                            <strong>Total Sales:</strong> $${data.totalSales.toFixed(2)}
                        </div>
                        <div class="report-recommendations">
                            <strong>Total Profit:</strong> $${data.totalProfit.toFixed(2)} | 
                            <strong>Profit Margin:</strong> ${profitMargin.toFixed(1)}%
                        </div>
                    </div>
                `;
            });
            
            html += `</div>`;
            profitDiv.innerHTML = html;
            
            // Create chart
            const ctx = document.getElementById('agronomistProfitChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (agronomistProfitChart) {
                agronomistProfitChart.destroy();
            }
            
            agronomistProfitChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: cropTypes.map(crop => crop.charAt(0).toUpperCase() + crop.slice(1)),
                    datasets: [
                        {
                            label: 'Total Profit ($)',
                            data: cropProfitData,
                            backgroundColor: '#4CAF50',
                            borderColor: '#388E3C',
                            borderWidth: 1
                        },
                        {
                            label: 'Total Sales ($)',
                            data: cropSalesData,
                            backgroundColor: '#2196F3',
                            borderColor: '#1976D2',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Load agronomist farmers
        function loadAgronomistFarmers() {
            const farmersDiv = document.getElementById('farmersManagement');
            
            if (systemData.farmers.length === 0) {
                farmersDiv.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-users"></i>
                        <h4>No Farmers Registered</h4>
                        <p>Register farmers to start managing them.</p>
                    </div>
                `;
                return;
            }
            
            let html = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Farmer ID</th>
                            <th>Name</th>
                            <th>Location</th>
                            <th>Contact</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            systemData.farmers.forEach(farmer => {
                // Calculate farmer's total profit
                const farmerProfits = systemData.profits.filter(p => p.farmerId === farmer.id);
                const totalProfit = farmerProfits.reduce((sum, p) => sum + p.profit, 0);
                
                html += `
                    <tr>
                        <td><strong>${farmer.id}</strong></td>
                        <td>${farmer.firstName} ${farmer.lastName}</td>
                        <td>${farmer.location}</td>
                        <td>${farmer.phone}<br>${farmer.email}</td>
                        <td>
                            <span class="status-badge status-completed">Active</span><br>
                            <small>Profit: $${totalProfit.toFixed(2)}</small>
                        </td>
                    </tr>
                `;
            });
            
            html += `</tbody></table>`;
            farmersDiv.innerHTML = html;
        }

        // Load agronomist reports section
        function loadAgronomistReports() {
            const reportsDiv = document.getElementById('agronomistReportsSection');
            
            if (systemData.reports.length === 0) {
                reportsDiv.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-file-medical-alt"></i>
                        <h4>No Reports Created</h4>
                        <p>Create reports for farmers based on your assessments.</p>
                    </div>
                `;
                return;
            }
            
            let html = `
                <div style="margin-bottom: 15px;">
                    <strong>Recent Reports:</strong>
                </div>
            `;
            
            const recentReports = systemData.reports.slice(-3).reverse();
            recentReports.forEach(report => {
                const farmer = systemData.farmers.find(f => f.id === report.farmerId);
                html += `
                    <div class="report-item" style="margin-bottom: 10px;">
                        <div class="report-header">
                            <div class="report-title">${report.title}</div>
                            <div class="report-date">${formatDate(report.date)}</div>
                        </div>
                        <div class="report-summary">
                            <strong>Farmer:</strong> ${farmer ? `${farmer.firstName} ${farmer.lastName}` : 'Unknown'} (${report.farmerId})
                        </div>
                        <div class="report-summary">
                            <strong>Type:</strong> ${report.type.replace('_', ' ').toUpperCase()}
                        </div>
                    </div>
                `;
            });
            
            reportsDiv.innerHTML = html;
        }

        // Load agronomist schedule
        function loadAgronomistSchedule() {
            const upcomingVisits = systemData.visits.filter(v => new Date(v.date) >= new Date());
            const scheduleDiv = document.getElementById('scheduleManagement');
            
            if (upcomingVisits.length === 0) {
                scheduleDiv.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-calendar-check"></i>
                        <h4>No Scheduled Visits</h4>
                        <p>Schedule farm visits to appear here.</p>
                    </div>
                `;
                return;
            }
            
            let html = `
                <div style="margin-bottom: 15px;">
                    <strong>Upcoming Visits (${upcomingVisits.length}):</strong>
                </div>
            `;
            
            upcomingVisits.forEach(visit => {
                const farmer = systemData.farmers.find(f => f.id === visit.farmerId);
                html += `
                    <div class="report-item" style="margin-bottom: 10px;">
                        <div class="report-header">
                            <div class="report-title">${visit.purpose.replace('_', ' ').toUpperCase()}</div>
                            <div class="report-date">${formatDate(visit.date)} at ${visit.time}</div>
                        </div>
                        <div class="report-summary">
                            <strong>Farmer:</strong> ${farmer ? `${farmer.firstName} ${farmer.lastName}` : 'Unknown'}
                        </div>
                        <div class="report-summary">
                            <strong>Location:</strong> ${visit.location}
                        </div>
                    </div>
                `;
            });
            
            scheduleDiv.innerHTML = html;
        }

        // Event Listeners
        // Auth tab switching
        authTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.getAttribute('data-tab');
                
                // Update active tab
                authTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                // Show corresponding form
                authForms.forEach(form => form.classList.remove('active'));
                document.getElementById(`${tabId}Form`).classList.add('active');
                
                // Clear error messages
                document.querySelectorAll('.error-message').forEach(el => {
                    el.style.display = 'none';
                });
            });
        });

        // Farmer signup
        document.getElementById('farmerSignupForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const firstName = document.getElementById('signupFirstName').value.trim();
            const lastName = document.getElementById('signupLastName').value.trim();
            const email = document.getElementById('signupEmail').value.trim();
            const phone = document.getElementById('signupPhone').value.trim();
            const location = document.getElementById('signupLocation').value.trim();
            const farmSize = parseFloat(document.getElementById('signupFarmSize').value);
            const mainCrop = document.getElementById('signupMainCrop').value.trim();
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('signupConfirmPassword').value;
            
            // Validation
            if (password !== confirmPassword) {
                document.getElementById('signupError').textContent = 'Passwords do not match';
                document.getElementById('signupError').style.display = 'block';
                return;
            }
            
            if (password.length < 6) {
                document.getElementById('signupError').textContent = 'Password must be at least 6 characters';
                document.getElementById('signupError').style.display = 'block';
                return;
            }
            
            // Check if email already exists
            if (systemData.farmers.some(f => f.email === email)) {
                document.getElementById('signupError').textContent = 'Email already registered';
                document.getElementById('signupError').style.display = 'block';
                return;
            }
            
            // Create farmer object
            const farmerId = generateFarmerId();
            const newFarmer = {
                id: farmerId,
                firstName,
                lastName,
                email,
                phone,
                location,
                farmSize,
                mainCrop,
                password,
                registrationDate: new Date().toISOString().split('T')[0],
                status: 'active'
            };
            
            // Add to system
            systemData.farmers.push(newFarmer);
            systemData.saveData();
            
            // Show success
            document.getElementById('signupError').style.display = 'none';
            document.getElementById('signupSuccess').textContent = `Account created successfully! Your Farmer ID is: ${farmerId}. Please save this ID.`;
            document.getElementById('signupSuccess').style.display = 'block';
            
            // Clear form
            document.getElementById('farmerSignupForm').reset();
            
            // Switch to login after 3 seconds
            setTimeout(() => {
                authTabs[0].click(); // Switch to farmer login
                document.getElementById('farmerLoginEmail').value = email;
                document.getElementById('signupSuccess').style.display = 'none';
            }, 3000);
        });

        // Farmer login
        document.getElementById('farmerLoginForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const email = document.getElementById('farmerLoginEmail').value.trim();
            const password = document.getElementById('farmerLoginPassword').value;
            
            // Find farmer
            const farmer = systemData.farmers.find(f => f.email === email && f.password === password);
            
            if (!farmer) {
                document.getElementById('farmerLoginError').textContent = 'Invalid email or password';
                document.getElementById('farmerLoginError').style.display = 'block';
                return;
            }
            
            // Set current user
            systemData.currentUser = farmer;
            
            // Show dashboard
            authPage.style.display = 'none';
            document.querySelector('header').style.display = 'block';
            farmerDashboard.style.display = 'block';
            
            // Load farmer data
            loadFarmerProfile();
            loadFarmerProfitTracking();
            loadFarmerReports();
            loadFarmerFarms();
            updateFarmerStats();
            
            showNotification(`Welcome back, ${farmer.firstName}!`, 'success');
        });

        // Agronomist login
        document.getElementById('agronomistLoginForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const username = document.getElementById('agroUsername').value.trim();
            const password = document.getElementById('agroPassword').value;
            
            if (username === systemData.agronomistCredentials.username && 
                password === systemData.agronomistCredentials.password) {
                
                // Set agronomist user
                systemData.currentUser = {
                    firstName: 'Aaron',
                    lastName: 'Agronomy',
                    role: 'agronomist'
                };
                
                // Show dashboard
                authPage.style.display = 'none';
                document.querySelector('header').style.display = 'block';
                agronomistDashboard.style.display = 'block';
                
                // Update UI
                userAvatar.textContent = 'AA';
                userName.textContent = 'Aaron Agronomy';
                userRole.textContent = 'Agronomist';
                
                // Load data
                updateAgronomistStats();
                loadAgronomistFarmers();
                loadAgronomistProfitAnalysis();
                loadAgronomistReports();
                loadAgronomistSchedule();
                
                showNotification('Welcome, Agronomist!', 'success');
            } else {
                document.getElementById('agroLoginError').textContent = 'Invalid username or password';
                document.getElementById('agroLoginError').style.display = 'block';
            }
        });

        // Logout
        logoutBtn.addEventListener('click', () => {
            systemData.currentUser = null;
            
            // Hide dashboards
            farmerDashboard.style.display = 'none';
            agronomistDashboard.style.display = 'none';
            document.querySelector('header').style.display = 'none';
            
            // Show auth page
            authPage.style.display = 'flex';
            
            // Clear forms
            document.querySelectorAll('form').forEach(form => form.reset());
            
            showNotification('Logged out successfully', 'info');
        });

        // Close modal buttons
        document.querySelectorAll('.close-modal').forEach(button => {
            button.addEventListener('click', function() {
                const modalId = this.getAttribute('data-modal');
                hideModal(modalId);
            });
        });

        // Close modal on outside click
        window.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                e.target.style.display = 'none';
            }
        });

        // Farmer dashboard buttons
        document.getElementById('addProfitRecordBtn')?.addEventListener('click', () => {
            // Load farms into dropdown
            const farmSelect = document.getElementById('profitFarm');
            farmSelect.innerHTML = '<option value="">Select farm (optional)</option>';
            
            const farmerId = systemData.currentUser?.id;
            if (farmerId) {
                const farms = systemData.farms.filter(f => f.farmerId === farmerId);
                farms.forEach(farm => {
                    const option = document.createElement('option');
                    option.value = farm.id;
                    option.textContent = farm.name;
                    farmSelect.appendChild(option);
                });
            }
            
            // Set current month and year
            const now = new Date();
            document.getElementById('profitMonth').value = now.getMonth() + 1;
            document.getElementById('profitYear').value = now.getFullYear();
            
            showModal('addProfitRecordModal');
        });

        document.getElementById('searchReportBtn')?.addEventListener('click', () => {
            showModal('searchReportModal');
        });

        document.getElementById('addFarmBtn')?.addEventListener('click', () => {
            showModal('addFarmModal');
        });

        document.getElementById('editProfileBtn')?.addEventListener('click', () => {
            const farmer = systemData.currentUser;
            if (!farmer) return;
            
            document.getElementById('editFirstName').value = farmer.firstName;
            document.getElementById('editLastName').value = farmer.lastName;
            document.getElementById('editEmail').value = farmer.email;
            document.getElementById('editPhone').value = farmer.phone;
            document.getElementById('editLocation').value = farmer.location;
            
            showModal('editProfileModal');
        });

        // Agronomist dashboard buttons
        document.getElementById('registerFarmerBtn')?.addEventListener('click', () => {
            showModal('registerFarmerModal');
        });

        document.getElementById('viewAllProfitsBtn')?.addEventListener('click', () => {
            // Load all profits into table
            const tableBody = document.getElementById('allProfitsTable');
            tableBody.innerHTML = '';
            
            systemData.profits.forEach(profit => {
                const farmer = systemData.farmers.find(f => f.id === profit.farmerId);
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${getMonthName(profit.month)} ${profit.year}</td>
                    <td>${profit.cropType.charAt(0).toUpperCase() + profit.cropType.slice(1)}</td>
                    <td>${profit.produce} kg</td>
                    <td>$${profit.sales.toFixed(2)}</td>
                    <td>$${profit.costs.toFixed(2)}</td>
                    <td>$${profit.profit.toFixed(2)}</td>
                    <td>${profit.profitMargin}%</td>
                `;
                tableBody.appendChild(row);
            });
            
            showModal('viewAllProfitsModal');
        });

        document.getElementById('createReportBtn')?.addEventListener('click', () => {
            showModal('createReportModal');
        });

        document.getElementById('scheduleVisitBtn')?.addEventListener('click', () => {
            showModal('scheduleVisitModal');
        });

        // Download all profits
        document.getElementById('downloadAllProfits')?.addEventListener('click', () => {
            showNotification('Profit report download started', 'success');
            // In a real app, this would generate a CSV or PDF
        });

        // Download profit report (farmer)
        document.getElementById('downloadProfitReport')?.addEventListener('click', () => {
            showNotification('Your profit report is being downloaded', 'success');
        });

        // Download system profit (agronomist)
        document.getElementById('downloadSystemProfit')?.addEventListener('click', () => {
            showNotification('System profit report is being downloaded', 'success');
        });

        // Form submissions
        // Add profit record form
        document.getElementById('addProfitRecordForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const farmerId = systemData.currentUser?.id;
            if (!farmerId) return;
            
            const cropType = document.getElementById('profitCropType').value;
            const month = parseInt(document.getElementById('profitMonth').value);
            const year = parseInt(document.getElementById('profitYear').value);
            const produce = parseFloat(document.getElementById('profitProduce').value);
            const sales = parseFloat(document.getElementById('profitSales').value);
            const costs = parseFloat(document.getElementById('profitCosts').value);
            const pricePerKg = parseFloat(document.getElementById('profitPricePerKg').value);
            const farmId = document.getElementById('profitFarm').value || null;
            const notes = document.getElementById('profitNotes').value;
            
            const { profit, profitMargin } = calculateProfit(sales, costs);
            
            const profitRecord = {
                id: systemData.generateId(),
                farmerId,
                cropType,
                month,
                year,
                produce,
                sales,
                costs,
                pricePerKg,
                profit,
                profitMargin,
                farmId,
                notes,
                createdAt: new Date().toISOString()
            };
            
            systemData.profits.push(profitRecord);
            systemData.saveData();
            
            hideModal('addProfitRecordModal');
            loadFarmerProfitTracking();
            updateFarmerStats();
            
            showNotification('Profit record added successfully!', 'success');
        });

        // Search report form
        document.getElementById('searchReportForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const farmerId = document.getElementById('reportSearchId').value.trim();
            const reports = systemData.reports.filter(r => r.farmerId === farmerId);
            const resultDiv = document.getElementById('reportSearchResult');
            
            if (reports.length === 0) {
                resultDiv.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: var(--danger);">
                        <i class="fas fa-exclamation-circle fa-2x" style="margin-bottom: 10px;"></i>
                        <p>No reports found for Farmer ID: ${farmerId}</p>
                        <p style="font-size: 14px;">Please check the ID and try again.</p>
                    </div>
                `;
            } else {
                let html = `<div style="margin-bottom: 15px;"><strong>Found ${reports.length} report(s):</strong></div>`;
                reports.forEach(report => {
                    html += `
                        <div class="report-item" style="margin-bottom: 10px;">
                            <div class="report-header">
                                <div class="report-title">${report.title}</div>
                                <div class="report-date">${formatDate(report.date)}</div>
                            </div>
                            <div class="report-summary">
                                <strong>Type:</strong> ${report.type.replace('_', ' ').toUpperCase()}
                            </div>
                            <div class="report-summary">
                                ${report.findings.substring(0, 150)}...
                            </div>
                        </div>
                    `;
                });
                resultDiv.innerHTML = html;
            }
        });

        // Add farm form
        document.getElementById('addFarmForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const farmerId = systemData.currentUser?.id;
            if (!farmerId) return;
            
            const farm = {
                id: systemData.generateId(),
                farmerId,
                name: document.getElementById('farmName').value.trim(),
                size: parseFloat(document.getElementById('farmSize').value),
                location: document.getElementById('farmLocation').value.trim(),
                crops: document.getElementById('farmCrops').value.trim(),
                soilType: document.getElementById('farmSoilType').value,
                createdAt: new Date().toISOString()
            };
            
            systemData.farms.push(farm);
            systemData.saveData();
            
            hideModal('addFarmModal');
            loadFarmerFarms();
            updateFarmerStats();
            
            showNotification('Farm added successfully!', 'success');
        });

        // Register farmer form (agronomist)
        document.getElementById('registerFarmerForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const farmerId = generateFarmerId();
            const password = 'welcome123'; // Default password
            
            const farmer = {
                id: farmerId,
                firstName: document.getElementById('newFarmerFirstName').value.trim(),
                lastName: document.getElementById('newFarmerLastName').value.trim(),
                email: document.getElementById('newFarmerEmail').value.trim(),
                phone: document.getElementById('newFarmerPhone').value.trim(),
                location: document.getElementById('newFarmerLocation').value.trim(),
                idNo: document.getElementById('newFarmerIdNo').value.trim(),
                farmSize: parseFloat(document.getElementById('newFarmerFarmSize').value),
                mainCrop: document.getElementById('newFarmerMainCrop').value.trim(),
                notes: document.getElementById('newFarmerNotes').value.trim(),
                password,
                registrationDate: new Date().toISOString().split('T')[0],
                status: 'active'
            };
            
            systemData.farmers.push(farmer);
            systemData.saveData();
            
            hideModal('registerFarmerModal');
            loadAgronomistFarmers();
            updateAgronomistStats();
            
            showNotification(`Farmer registered successfully! Farmer ID: ${farmerId}. Default password: ${password}`, 'success');
        });

        // Create report form (agronomist)
        document.getElementById('createReportForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const farmerId = document.getElementById('reportFarmerId').value.trim();
            
            // Check if farmer exists
            const farmer = systemData.farmers.find(f => f.id === farmerId);
            if (!farmer) {
                showNotification('Farmer ID not found. Please check and try again.', 'error');
                return;
            }
            
            const report = {
                id: systemData.generateId(),
                farmerId,
                title: document.getElementById('reportTitle').value.trim(),
                type: document.getElementById('reportType').value,
                date: document.getElementById('reportDate').value,
                findings: document.getElementById('reportFindings').value,
                recommendations: document.getElementById('reportRecommendations').value,
                notes: document.getElementById('reportNotes').value,
                createdBy: 'agronomist',
                createdAt: new Date().toISOString()
            };
            
            systemData.reports.push(report);
            systemData.saveData();
            
            hideModal('createReportModal');
            loadAgronomistReports();
            updateAgronomistStats();
            
            showNotification(`Report created successfully for ${farmer.firstName} ${farmer.lastName}!`, 'success');
        });

        // Schedule visit form
        document.getElementById('scheduleVisitForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const farmerId = document.getElementById('visitFarmerId').value.trim();
            
            // Check if farmer exists
            const farmer = systemData.farmers.find(f => f.id === farmerId);
            if (!farmer) {
                showNotification('Farmer ID not found. Please check and try again.', 'error');
                return;
            }
            
            const visit = {
                id: systemData.generateId(),
                farmerId,
                purpose: document.getElementById('visitPurpose').value,
                date: document.getElementById('visitDate').value,
                time: document.getElementById('visitTime').value,
                location: document.getElementById('visitLocation').value.trim(),
                notes: document.getElementById('visitNotes').value,
                status: 'scheduled',
                createdAt: new Date().toISOString()
            };
            
            systemData.visits.push(visit);
            systemData.saveData();
            
            hideModal('scheduleVisitModal');
            loadAgronomistSchedule();
            updateAgronomistStats();
            
            showNotification(`Visit scheduled for ${farmer.firstName} ${farmer.lastName}!`, 'success');
        });

        // Edit profile form
        document.getElementById('editProfileForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const farmer = systemData.currentUser;
            if (!farmer) return;
            
            // Update farmer data
            farmer.firstName = document.getElementById('editFirstName').value.trim();
            farmer.lastName = document.getElementById('editLastName').value.trim();
            farmer.email = document.getElementById('editEmail').value.trim();
            farmer.phone = document.getElementById('editPhone').value.trim();
            farmer.location = document.getElementById('editLocation').value.trim();
            
            const newPassword = document.getElementById('editPassword').value;
            const confirmPassword = document.getElementById('editConfirmPassword').value;
            
            if (newPassword && newPassword === confirmPassword) {
                farmer.password = newPassword;
            } else if (newPassword && newPassword !== confirmPassword) {
                showNotification('Passwords do not match', 'error');
                return;
            }
            
            // Update in system
            const index = systemData.farmers.findIndex(f => f.id === farmer.id);
            if (index !== -1) {
                systemData.farmers[index] = farmer;
                systemData.saveData();
            }
            
            hideModal('editProfileModal');
            loadFarmerProfile();
            
            showNotification('Profile updated successfully!', 'success');
        });

        // Initialize date fields with today's date
        document.addEventListener('DOMContentLoaded', () => {
            const today = new Date().toISOString().split('T')[0];
            document.querySelectorAll('input[type="date"]').forEach(input => {
                if (!input.value) {
                    input.value = today;
                }
            });
            
            // Set time to next hour
            const nextHour = new Date();
            nextHour.setHours(nextHour.getHours() + 1);
            const timeString = nextHour.getHours().toString().padStart(2, '0') + ':00';
            
            document.querySelectorAll('input[type="time"]').forEach(input => {
                if (!input.value) {
                    input.value = timeString;
                }
            });
        });
    </script>
</body>
</html>

